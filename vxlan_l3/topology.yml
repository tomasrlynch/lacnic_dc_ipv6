---
provider: clab
defaults.device: vyos
module: [ bgp ]
plugin: [ bgp.session, ebgp.multihop ]
bgp:
    community.ebgp: [ standard, extended ]
    activate:
        ipv6: [ ebgp ]
    multihop:
        #sessions: [ leaf1-leaf2, leaf1-leaf3, leaf1-leaf4, leaf2-leaf3, leaf2-leaf4, leaf3-leaf4 ]
        sessions: [ leaf1-leaf3, leaf2-leaf4 ]
        activate:
            ipv6: [ evpn ]
vlans:
    verde:
    azul:
evpn:
    as: 64496
    session:
    - ebgp
    vlans:
    - verde
    - azul
addressing:
    core:
        unnumbered: true
    loopback:
        ipv4:
        ipv6: 2001:db8:100::/48
    p2p:
        ipv4: 
        ipv6: 2001:db8:ff::/48
    lan:
        ipv4: 100.65.0.0/16 # for vxlan
        ipv6: 2001:db8:aa::/48
nodes:
#    borde1:
#    borde2:
    spine1:
        loopback:
            ipv6: 2001:db8:64:11::11/64
    spine2:
        loopback:
            ipv6: 2001:db8:64:22::22/64
    leaf1:
        bgp.as: 64521
        loopback:
            ipv4: 100.64.0.1/32
            ipv6: 2001:db8:64:1::1/64
    leaf2:
        bgp.as: 64522
        loopback:
            ipv4: 100.64.0.2/32
            ipv6: 2001:db8:64:2::2/64
    leaf3:
        bgp.as: 64523
        loopback:
            ipv4: 100.64.0.3/32
            ipv6: 2001:db8:64:3::3/64
    leaf4:
        bgp.as: 64524
        loopback:
            ipv4: 100.64.0.4/32
            ipv6: 2001:db8:64:4::4/64
#    transito1:
#        loopback:
#            ipv6: 2001:db8:501::1/48
#        bgp.as: 65001
#    transito2:
#        loopback:
#            ipv6: 2001:db8:502::2/48
#        bgp.as: 65002
    host1:
    host2:
    host3:
    host4:
groups:
    hosts:
        members: [ host1, host2, host3, host4 ]
        device: linux
#    borde:
#        members: [ borde1, borde2 ]
#        module: [ bgp, isis ]
#        bgp.activate.ipv6: [ ibgp, ebgp ]
#        bgp.as: 64500
    spine:
        members: [ spine1, spine2 ]
        bgp.activate.ipv4: [ ebgp ]
        bgp.as: 64510
    leaf:
        members: [ leaf1, leaf2, leaf3, leaf4 ]
        module: [ vlan, vxlan, bgp, evpn ]
        #bgp.activate.ipv4: [ ebgp ]
        device: frr
#    transito: 
#        members: [ transito1, transito2 ]
links:
    # Enlaces Internos GUA
#    - borde1 - borde2
#    - borde1 - spine1
#    - borde1 - spine2
#    - borde2 - spine1
#    - borde2 - spine2
    # Enlaces Internos LLA
    - spine1:
      leaf1:
      pool: core
    - spine1:
      leaf2:
      pool: core
    - spine1:
      leaf3:
      pool: core
    - spine1:
      leaf4:
      pool: core
    - spine2:
      leaf1:
      pool: core
    - spine2:
      leaf2:
      pool: core
    - spine2:
      leaf3:
      pool: core
    - spine2:
      leaf4:
      pool: core
    # Enlaces a Hosts (unicast)
    - host1:
      leaf1:
    - host2:
      leaf2:
    # Enlaces a Hosts (l2vpn)
    - name: l2vpn-host1
      leaf1:
          vlan.access: azul
      host1:
    - name: l2vpn-host2
      leaf2:
          vlan.access: verde
      host2:
    - name: l2vpn-host3
      leaf3:
        vlan.access: azul
      host3:
    - name: l2vpn-host4
      leaf4:
        vlan.access: verde
      host4:
    # Enlaces Externos
#    - borde1 - transito1
#    - borde2 - transito2
#    - transito1 - transito2
